(this.webpackJsonptao=this.webpackJsonptao||[]).push([[0],{64:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameService=void 0;var i=n(91),a=n(93),r=function(){var e=this;this.applyAbility=function(e,t,n,i){return i},this.callApplyAbility=function(e,t,n,i){return!1},this.createUnitID=function(e){return[e.player.id,e.id]},this.getUnitbyUnitID=function(t){return e.game.units.filter((function(e){return e.player.id==t[0]&&e.id==t[1]}))[0]},this.players=[new a.Player1,new a.Player2],this.game=new i.Game({players:this.players})};t.GameService=r},71:function(e,t,n){},72:function(e,t,n){},73:function(e,t,n){},75:function(e,t,n){},90:function(e,t,n){},91:function(e,t,n){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var i=Array(e),a=0;for(t=0;t<n;t++)for(var r=arguments[t],l=0,c=r.length;l<c;l++,a++)i[a]=r[l];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.Game=void 0;var a=n(92),r=function(e){var t=this;this.initializePlayers=function(){return t.players.map((function(e){return e.units=t.initializeUnits(e)}))},this.initializeUnits=function(e){var n=e.unitModels.map((function(t,n){return new a.GameUnit(n,e,t)}));return t.units=i(t.units,n),n},this.applyAbility=function(e,n,i,a){switch(n.targets[0]){case"Clicked":var r=n.ability.apply(e,n,[i]);return t.changeTurn(),a.map((function(e,t){return t===i.id?r[0]:e}));case"All_by_Player":var l=n.ability.apply(e,n,a);return t.changeTurn(),l;default:return t.changeTurn(),a}},this.getUnitsByPlayer=function(e){return t.units.filter((function(t){return t.player===e}))},this.changeTurn=function(){t.checkForWinner()?console.log("TBD: proclaim winner"):(t.switchToNextPlayer(),t.turn++)},this.switchToNextPlayer=function(){var e=t.players.length,n=t.players.indexOf(t.currentPlayer)+1,i=e===n?0:n;t.currentPlayer=t.players[i]},this.checkForWinner=function(){return console.log("TBD: are there losers?"),!1},this.players=e.players,this.turn=e.turn||0,this.currentPlayer=e.currentPlayer||e.players[0],this.units=[],this.initializePlayers()};t.Game=r},92:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GameUnit=void 0;var i=function(e,t,n){this.id=e,this.player=t,console.log("Live unit"),this.name=n.name,this.life=n.maxlife,this.maxlife=n.maxlife,this.abilities=n.abilities};t.GameUnit=i},93:function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.Player2=t.Player1=t.Player=void 0;var a=n(94),r=function(e){this.name=e.name,this.id=e.id,this.unitModels=e.unitModels,this.units=[],this.alive=!0};t.Player=r;var l=function(e){function t(){return e.call(this,{name:"Player1",id:1,unitModels:[a.Knight,a.Healer],units:[],alive:!0})||this}return i(t,e),t}(r);t.Player1=l;var c=function(e){function t(){return e.call(this,{name:"Player2",id:2,unitModels:[a.Knight,a.Healer],units:[],alive:!0})||this}return i(t,e),t}(r);t.Player2=c},94:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Healer=t.Knight=t.GameUnit=void 0;var i=n(95),a=function(e){this.name=e.name,this.maxlife=e.maxlife,this.abilities=e.abilities};t.GameUnit=a,t.Knight={name:"Knight",maxlife:50,abilities:[{name:i.Attack.name,damage:10,targets:["Clicked"],ability:i.Attack}]},t.Healer={name:"Healer",maxlife:30,abilities:[{name:i.Heal.name,damage:6,targets:["All_by_Player"],ability:i.Heal}]}},95:function(e,t,n){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Heal=t.Attack=void 0,t.Attack={name:"Attack",targets:["Enemy"],apply:function(e,t,n){return n.map((function(e){return i(i({},e),{life:Math.min(e.maxlife,e.life-t.damage)})}))}},t.Heal={name:"Heal",targets:["Ally"],apply:function(e,t,n){return n.map((function(e){return i(i({},e),{life:Math.min(e.maxlife,e.life+t.damage)})}))}}},96:function(e,t,n){"use strict";n.r(t);var i,a=n(4),r=n.n(a),l=n(59),c=n.n(l),s=(n(71),n(72),n(73),n(5)),o=function(e){return Object(s.jsx)("div",{className:"Menu",children:Object(s.jsxs)("ul",{children:[Object(s.jsx)("li",{children:"Units"}),Object(s.jsx)("li",{children:"Battle"})]})})},u=n(19),y=(n(75),n(26)),p=n(20),h=n(60),f=n(63),d=new p.HttpLink({uri:"http://localhost:4444/graphql"}),b=new h.a({uri:"ws://localhost:4444/graphql",options:{reconnect:!0}}),m=Object(p.split)((function(e){var t=e.query,n=Object(f.a)(t);return"OperationDefinition"===n.kind&&"subscription"===n.operation}),b,d),v=new p.ApolloClient({link:m,uri:"http://localhost:4444/graphql",cache:new p.InMemoryCache});v.subscribe({query:Object(p.gql)(i||(i=Object(y.a)(["\n    subscription onTurn {\n      sendTurn {\n        applyingUnitID\n        unitAbilityName\n        recivingUnitID\n        recivingUnitIDs\n      }\n    }\n    "]))),variables:{}}).subscribe({next:function(e){console.log("Subscription onTurn event"),console.log(e)}});var g,j,O=n(30),U=function e(t){Object(O.a)(this,e),this.name=void 0,this.maxlife=void 0,this.life=void 0,this.name=t.name,this.life=t.maxlife,this.maxlife=t.maxlife},x=function e(t){var n=this;Object(O.a)(this,e),this.apolloClient=void 0,this.getUnits=function(e){return n.apolloClient.query({query:Object(p.gql)(g||(g=Object(y.a)(["{\n            units {\n              name\n              maxlife\n            }\n          }"])))}).then((function(t){return e(t.data.units)})).catch((function(){return!1}))},this.initializeUnits=function(e){return e.map((function(e){return new U(e)}))},this.apolloClient=t},A=(n(90),function(e){var t=e.unit,n=Object(u.a)(e.selectedUnit,2),i=n[0],a=n[1],r=Object(u.a)(e.selectedAbilty,2),l=r[0],c=r[1],o=Object(u.a)(e.turn,2),y=o[0],p=o[1],h=function(){1===e.unit.player.id&&e.dispatchMyAbility({type:"apply",applyingUnit:i,selectedAbilty:l,receivingUnit:t}),2===e.unit.player.id&&e.dispatchEnemyAbility({type:"apply",applyingUnit:i,selectedAbilty:l,receivingUnit:t}),a(null),c(null),p(y+1)};return Object(s.jsxs)("div",{className:"Unit"+(i===t?" selectedUnit":""),onClick:function(n){y%2+1===e.unit.player.id?l&&"Ally"===l.ability.targets[0]?h():null===i||e.unit.player.id===i.player.id?(a(i===t?null:t),c(null)):console.log("no ability selected"):i?l&&"Enemy"===l.ability.targets[0]?h():console.log("Can't apply to enemy"):console.log("It's not your unit")},children:[Object(s.jsx)("h4",{children:t.name}),Object(s.jsx)("h6",{children:t.life>0?"Alive":"Dead"}),Object(s.jsx)("h6",{children:e.unit.player.name}),Object(s.jsxs)("div",{children:["Life: ",Object(s.jsx)("span",{children:t.life>0?t.life:0})]})]})}),P=n(66),D=n(65),I=function(e){Object(P.a)(n,e);var t=Object(D.a)(n);function n(e){var i;return Object(O.a)(this,n),(i=t.call(this)).apolloClient=void 0,i.applyAbility=function(e,t,n,a){return console.log("ClientGameService - applyAbility"),console.log(i.createUnitID(e)),console.log(t.ability.name),console.log(i.createUnitID(n)),console.log(a.map((function(e){return i.createUnitID(e)}))),i.apolloClient.mutate({variables:{applyingUnitID:i.createUnitID(e),unitAbilityName:t.ability.name,recivingUnitID:i.createUnitID(n),recivingUnitIDs:a.map((function(e){return i.createUnitID(e)}))},mutation:Object(p.gql)(j||(j=Object(y.a)(["\n        mutation ApplyAbility(\n          $applyingUnitID: [ID],\n          $unitAbilityName: String,\n          $recivingUnitID: [ID],\n          $recivingUnitIDs: [[ID]]\n        ) {\n          applyAbility(\n            applyingUnitID: $applyingUnitID,\n            unitAbilityName: $unitAbilityName,\n            recivingUnitID: $recivingUnitID,\n            recivingUnitIDs: $recivingUnitIDs\n          )\n        }\n      "])))}).then((function(e){return console.log(e)})).catch((function(e){return console.log(e)})),i.game.applyAbility(e,t,n,a)},i.apolloClient=e,i}return n}(n(64).GameService);console.log("New Game Loading");var _=new I(v);function w(e,t){switch(t.type){case"apply":return _.applyAbility(t.applyingUnit,t.selectedAbilty,t.receivingUnit,e);default:return e}}var C=function(e){var t,n;Object(a.useEffect)((function(){new x(v).getUnits((function(e){return console.log(e)}))}),[]);var i=Object(a.useReducer)(w,null===(t=_.game)||void 0===t?void 0:t.getUnitsByPlayer(_.game.players[0])),r=Object(u.a)(i,2),l=r[0],c=r[1],o=Object(a.useReducer)(w,null===(n=_.game)||void 0===n?void 0:n.getUnitsByPlayer(_.game.players[1])),y=Object(u.a)(o,2),p=y[0],h=y[1],f=Object(a.useState)(1),d=Object(u.a)(f,2),b=d[0],m=d[1];Object(a.useEffect)((function(){console.log("Update Turn"),m(_.game.turn)}),[_]);var g=Object(a.useState)(null),j=Object(u.a)(g,2),O=j[0],U=(j[1],Object(a.useState)(null)),P=Object(u.a)(U,2),D=P[0],I=P[1];return Object(s.jsxs)("div",{className:"Main",children:[Object(s.jsx)("div",{className:"Timer",children:"Timer"}),Object(s.jsxs)("div",{className:"Turn",children:["Turn: ",b," - CurrentPlayer: ",b%2]}),Object(s.jsxs)("div",{className:"Battle",children:[l.map((function(e){return Object(s.jsx)(A,{unit:e,turn:f,dispatchMyAbility:c,dispatchEnemyAbility:h,selectedAbilty:U,selectedUnit:g},e.id)})),Object(s.jsx)("div",{className:"Divider",children:"vs"}),p.map((function(e){return Object(s.jsx)(A,{unit:e,turn:f,dispatchMyAbility:c,dispatchEnemyAbility:h,selectedAbilty:U,selectedUnit:g},e.id)}))]}),Object(s.jsx)("div",{className:"Controls",children:null===O||void 0===O?void 0:O.abilities.map((function(e){return Object(s.jsx)("div",{className:"Control"+(D===e?" selected":""),onClick:function(t){I(e)},children:Object(s.jsxs)("span",{children:[e.ability.name,": ",e.damage]})})}))})]})};var M=function(){return Object(s.jsxs)("div",{className:"App",children:[Object(s.jsx)(o,{}),Object(s.jsx)(C,{})]})},N=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,97)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,r=t.getLCP,l=t.getTTFB;n(e),i(e),a(e),r(e),l(e)}))};c.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(M,{})}),document.getElementById("root")),N()}},[[96,1,2]]]);
//# sourceMappingURL=main.e637c0f8.chunk.js.map